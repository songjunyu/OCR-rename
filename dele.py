#删除包含学生两个字的文件
#import cv2
import re
import os
import pytesseract    #?????????????
from PIL import Image
import tkinter as tk
from tkinter.filedialog import askdirectory   #python ??????????????????

left = 60
top = 0
right = 225
bottom = 140
list1 = [ '学', '生']
class BatchRename():
    def __init__(self):
        pass

    def rename(self,path):
        self.path = path
        filelist = os.listdir(self.path)  # ??????????
        total_num = len(filelist)  # ?????????????????
        print(total_num)
        for item in filelist:
            try:
                item_path = os.path.join(path, item)  # ???????????
                if os.path.isdir(item_path):  # ??????????????????????? ??-->TRUE
                    self.rename(item_path)  # ??????????????????????
                # else:
                #     print(item_path)
                #     extension_name = os.path.splitext(item_path)  # ?????????????????????????????
                #     print(extension_name)
            except:
                continue
            if item.endswith('.jpg'):  # ????????????jpg????????????????png?????????????????????????????????????????????????????????????????????????
                path : str = os.path.join(os.path.abspath(self.path), item)
                # print(path)
                im = Image.open(path)
                im = im.crop((0, 0, im.size[0] * 2 / 3, im.size[1] / 2))
                #image = im.crop((left, top, right, bottom))  # ???????????
                #code = pytesseract.image_to_string(im, lang="eng",
                                                   #config="--psm 6")  # lang?????????????????????????????????????????????????????????
                code = pytesseract.image_to_string(im, lang="chi_sim",
                                                   config="--psm 6")  # lang??????????????????????????????????????????????????????

                code_str = list(code)

                for i in code_str:
                    if ' ' in code_str:
                        code_str.remove(' ')

                no_exist = [False for a in list1 if a not in code_str]
                if no_exist:
                    print('成绩单')
                    os.remove(path)
                else:
                    print("学籍卡")
                    continue
              
if __name__ == '__main__':
    tk.Tk().withdraw()
    path = askdirectory()
    demo = BatchRename()
    demo.rename(path)